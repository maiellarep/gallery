{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\internship\\\\new\\\\gallery\\\\src\\\\AddImg.js\";\nimport React from 'react';\nimport './css/common.css';\nimport IndexedDbRepository from './IndexedRepository';\nimport Menu from './Menu';\nimport './css/Buttons.css';\nimport './css/Inputs.css';\nimport logo from './img/defaultOrganisationLogo.jpg';\n\nclass AddImg extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleAdd = () => {\n      if (this.state.image != null) {\n        if (this.state.name != null) {\n          var date = new Date();\n          var day = date.getDate();\n          var month = date.getMonth() + 1;\n          var year = date.getFullYear();\n          var obj = {\n            image: this.state.image,\n            name: this.state.name,\n            description: this.state.description,\n            format: this.state.format,\n            date: day + '.' + month + '.' + year,\n            mimetype: this.state.mimetype,\n            weight: this.state.weight,\n            size: this.state.size,\n            collection: this.state.collection,\n            tags: this.state.tags\n          };\n          this.repository.save('photos', obj).then(window.location = '/add');\n        } else {\n          alert();\n        }\n      } else {\n        alert(\"Добавьте изображение!\");\n      }\n    };\n\n    this.handleChange = this.handleChange.bind(this);\n    this.handleImageChange = this.handleImageChange.bind(this);\n    this.handleAdd = this.handleAdd.bind(this);\n    this.state = {\n      name: null,\n      format: 'Альбом',\n      description: null,\n      size: null,\n      weight: null,\n      mimetype: null,\n      image: null,\n      collection: null,\n      tags: [],\n      colList: [],\n      preview: logo\n    };\n  }\n\n  componentDidMount() {\n    document.title = \"Добавление картинки\";\n    this.repository = new IndexedDbRepository(); //this.repository.findAll('photos').then( tasks => this.setState( { tasks } ) );\n\n    this.repository.findAll('collections').then(colList => this.setState({\n      colList\n    }));\n  }\n\n  handleChange(e) {\n    if (e.target.name === 'tags') {\n      var arr = e.target.value.split(',');\n      this.setState({\n        tags: arr\n      });\n    } else {\n      this.setState({\n        [e.target.name]: e.target.value\n      });\n    }\n  }\n\n  handleImageChange(e) {\n    var file = e.target.files[0];\n\n    if (file.type.split('/')[0] === 'image') {\n      this.setState({\n        mimetype: '.' + file.type.split('/')[1],\n        weight: (file.size / 1024 / 1024).toFixed(2) + \" МБ\",\n        preview: URL.createObjectURL(file)\n      });\n      var reader = new FileReader();\n      reader.readAsBinaryString(file);\n\n      reader.onload = function (e) {\n        let bits = e.target.result;\n        var img = new Image();\n        img.src = 'data:image/' + this.state.mimetype.split('.').pop() + ';base64,' + btoa(bits);\n\n        img.onload = () => {\n          var size = img.height + \"х\" + img.width + \" px\";\n          this.setState({\n            image: 'data:image/' + this.state.mimetype.split('.').pop() + ';base64,' + btoa(bits),\n            size: size\n          });\n        };\n      }.bind(this);\n    } else {\n      alert(\"Неправильный тип файла! Загрузите изображение!\");\n    }\n  }\n\n  handleClick(e) {\n    window.location = '/';\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      class: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 17\n      }\n    }, \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435 \\u043D\\u043E\\u0432\\u043E\\u0439 \\u043A\\u0430\\u0440\\u0442\\u0438\\u043D\\u043A\\u0438\")), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"imgcontent\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: this.state.preview,\n      class: \"preview\",\n      id: \"preview\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 81\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"file\",\n      accept: \"image/*\",\n      name: \"image\",\n      onChange: this.handleImageChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 99\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      class: \"input_1\",\n      id: \"name\",\n      name: \"name\",\n      type: \"text\",\n      placeholder: \"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u043A\\u0430\\u0440\\u0442\\u0438\\u043D\\u043A\\u0438\",\n      onChange: this.handleChange,\n      required: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 146\n      }\n    }), /*#__PURE__*/React.createElement(\"textarea\", {\n      class: \"textarea_1\",\n      id: \"description\",\n      name: \"description\",\n      type: \"text\",\n      placeholder: \"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u043E\\u043F\\u0438\\u0441\\u0430\\u043D\\u0438\\u0435 \\u043A\\u0430\\u0440\\u0442\\u0438\\u043D\\u043A\\u0438...\",\n      onChange: this.handleChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 24\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      class: \"input_1\",\n      name: \"tags\",\n      type: \"text\",\n      placeholder: \"\\u0422\\u0435\\u0433\\u0438 \\u0447\\u0435\\u0440\\u0435\\u0437 \\u0437\\u0430\\u043F\\u044F\\u0442\\u0443\\u044E \\u0431\\u0435\\u0437 \\u043F\\u0440\\u043E\\u0431\\u0435\\u043B\\u0430. \\u041F\\u0440\\u0438\\u043C\\u0435\\u0440: \\u0442\\u0435\\u04331,\\u0442\\u0435\\u04332\",\n      onChange: this.handleChange,\n      required: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 168\n      }\n    }), /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 13\n      }\n    }, \"\\u0424\\u043E\\u0440\\u043C\\u0430\\u0442 \"), /*#__PURE__*/React.createElement(\"select\", {\n      class: \"select\",\n      name: \"format\",\n      onChange: this.handleChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"option\", {\n      value: \"\\u0410\\u043B\\u044C\\u0431\\u043E\\u043C\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 17\n      }\n    }, \"\\u0410\\u043B\\u044C\\u0431\\u043E\\u043C\"), /*#__PURE__*/React.createElement(\"option\", {\n      value: \"\\u041F\\u043E\\u0440\\u0442\\u0440\\u0435\\u0442\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 17\n      }\n    }, \"\\u041F\\u043E\\u0440\\u0442\\u0440\\u0435\\u0442\"), /*#__PURE__*/React.createElement(\"option\", {\n      value: \"\\u041A\\u0432\\u0430\\u0434\\u0440\\u0430\\u0442\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 17\n      }\n    }, \"\\u041A\\u0432\\u0430\\u0434\\u0440\\u0430\\u0442\")), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 22\n      }\n    }), /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 13\n      }\n    }, \"\\u041A\\u043E\\u043B\\u043B\\u0435\\u043A\\u0446\\u0438\\u044F \"), /*#__PURE__*/React.createElement(\"select\", {\n      class: \"select\",\n      name: \"collection\",\n      onChange: this.handleChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 13\n      }\n    }, this.state.colList.map(item => {\n      return /*#__PURE__*/React.createElement(\"option\", {\n        value: item.colName,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 29\n        }\n      }, item.colName);\n    })), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 22\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      class: \"button\",\n      type: \"button\",\n      onClick: this.handleClick,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 13\n      }\n    }, \"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\"), /*#__PURE__*/React.createElement(\"button\", {\n      class: \"button\",\n      type: \"button\",\n      onClick: this.handleAdd,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 13\n      }\n    }, \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C\")));\n  }\n\n}\n\nexport default AddImg;","map":{"version":3,"sources":["C:/Users/User/Desktop/internship/new/gallery/src/AddImg.js"],"names":["React","IndexedDbRepository","Menu","logo","AddImg","Component","constructor","props","handleAdd","state","image","name","date","Date","day","getDate","month","getMonth","year","getFullYear","obj","description","format","mimetype","weight","size","collection","tags","repository","save","then","window","location","alert","handleChange","bind","handleImageChange","colList","preview","componentDidMount","document","title","findAll","setState","e","target","arr","value","split","file","files","type","toFixed","URL","createObjectURL","reader","FileReader","readAsBinaryString","onload","bits","result","img","Image","src","pop","btoa","height","width","handleClick","render","map","item","colName"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport './css/common.css';\r\nimport IndexedDbRepository from './IndexedRepository';\r\nimport Menu from './Menu';\r\nimport './css/Buttons.css';\r\nimport './css/Inputs.css';\r\nimport logo from './img/defaultOrganisationLogo.jpg';\r\n\r\nclass AddImg extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.handleChange = this.handleChange.bind(this);\r\n        this.handleImageChange = this.handleImageChange.bind(this);\r\n        this.handleAdd = this.handleAdd.bind(this);\r\n        this.state = {\r\n            name: null,\r\n            format: 'Альбом',\r\n            description: null, \r\n            size: null,\r\n            weight: null,\r\n            mimetype: null,\r\n            image: null,\r\n            collection: null,\r\n            tags: [],\r\n            colList: [],\r\n            preview: logo\r\n        }\r\n\r\n    }\r\n\r\n    componentDidMount() {\r\n        document.title = \"Добавление картинки\";\r\n        this.repository = new IndexedDbRepository();\r\n        //this.repository.findAll('photos').then( tasks => this.setState( { tasks } ) );\r\n        this.repository.findAll('collections'). then( colList => this.setState( { colList } ) );\r\n    }\r\n\r\n    handleChange(e) {\r\n        if(e.target.name === 'tags')\r\n        {\r\n            var arr = e.target.value.split(',');\r\n            this.setState({tags: arr});\r\n        }\r\n        else{\r\n            this.setState({[e.target.name]: e.target.value});\r\n        }\r\n\r\n    }\r\n\r\n    handleImageChange(e) {\r\n        var file = e.target.files[0];\r\n        if(file.type.split('/')[0] === 'image')\r\n        {\r\n            this.setState({\r\n                mimetype: '.' + file.type.split('/')[1],\r\n                weight: (file.size/1024/1024).toFixed(2) + \" МБ\",\r\n                preview: URL.createObjectURL(file)\r\n            });\r\n            var reader = new FileReader();\r\n            reader.readAsBinaryString(file);\r\n            \r\n                    reader.onload = function(e) {\r\n                        let bits = e.target.result;\r\n                        var img = new Image();\r\n                        img.src = 'data:image/'+ this.state.mimetype.split('.').pop()+';base64,' + btoa(bits);\r\n                        img.onload = () => {\r\n                            \r\n                        var size = img.height + \"х\" + img.width + \" px\";\r\n                            this.setState({\r\n                                image: 'data:image/'+ this.state.mimetype.split('.').pop()+';base64,' + btoa(bits),\r\n                                size: size\r\n                            });\r\n                        }\r\n                        \r\n                    }.bind(this);\r\n    \r\n        }\r\n        else \r\n        {\r\n            alert(\"Неправильный тип файла! Загрузите изображение!\");\r\n        }\r\n        \r\n    }\r\n\r\n    handleAdd = () => {\r\n        if(this.state.image != null)\r\n        {\r\n            if(this.state.name != null)\r\n            {\r\n                var date = new Date();\r\n                var day = date.getDate();\r\n                var month = date.getMonth()+1;\r\n                var year = date.getFullYear();\r\n        \r\n                var obj = { image: this.state.image, \r\n                    name: this.state.name, \r\n                    description: this.state.description, \r\n                    format: this.state.format,\r\n                    date: day + '.' + month + '.' + year,\r\n                    mimetype: this.state.mimetype,\r\n                    weight: this.state.weight,\r\n                    size: this.state.size,\r\n                    collection: this.state.collection,\r\n                    tags: this.state.tags};\r\n        \r\n                this.repository.save( 'photos', obj).then(window.location = ('/add'));\r\n            }\r\n            else\r\n            {\r\n                alert();\r\n            }\r\n        }\r\n        else\r\n        {\r\n            alert(\"Добавьте изображение!\");\r\n        }\r\n    };\r\n    \r\n    handleClick(e) {\r\n        window.location = ('/');\r\n    }\r\n\r\n\r\n    render() {\r\n        return (\r\n            <div class = \"container\">\r\n            <div class = \"header\"> \r\n                <h1>Добавление новой картинки</h1>\r\n            </div>\r\n            <div class = \"imgcontent\">\r\n                <img src = {this.state.preview} class = \"preview\" id=\"preview\"/><br/>\r\n            <input type=\"file\" accept = \"image/*\" name=\"image\" onChange={this.handleImageChange}/><br/>\r\n            <input class = \"input_1\" id=\"name\" name=\"name\" type=\"text\"  placeholder = \"Название картинки\" onChange={this.handleChange} required/><br/>\r\n            <textarea class=\"textarea_1\" id=\"description\" name=\"description\" type=\"text\" placeholder = \"Введите описание картинки...\" onChange={this.handleChange}>        \r\n            </textarea><br/>\r\n            <input class = \"input_1\" name=\"tags\" type=\"text\"  placeholder = \"Теги через запятую без пробела. Пример: тег1,тег2\" onChange={this.handleChange} required/><br/>\r\n            <label>Формат </label>\r\n            <select class = \"select\" name=\"format\" onChange={this.handleChange}>\r\n                <option value=\"Альбом\">Альбом</option>\r\n                <option value=\"Портрет\">Портрет</option>\r\n                <option value=\"Квадрат\">Квадрат</option>\r\n            </select><br/>\r\n            <label>Коллекция </label>\r\n            <select class = \"select\" name=\"collection\" onChange={this.handleChange}>\r\n                {\r\n                    this.state.colList.map((item) => {\r\n                        return(\r\n                            <option value={item.colName}>{item.colName}</option>\r\n                        );\r\n                    })\r\n                }\r\n            </select><br/>\r\n            {/*<input id=\"collection\" class=\"input_1\" name=\"collection\" type=\"text\" value={this.state.collection} onChange={this.handleChange} required/><br/>*/}\r\n            <button class = \"button\" type=\"button\" onClick={this.handleClick}>Отмена</button>\r\n            <button class = \"button\" type=\"button\" onClick={this.handleAdd}>Добавить</button>\r\n                </div>\r\n            \r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\nexport default AddImg;"]},"metadata":{},"sourceType":"module"}