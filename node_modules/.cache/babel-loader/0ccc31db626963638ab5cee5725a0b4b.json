{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\internship\\\\new\\\\gallery\\\\src\\\\CollectionItemPg.js\";\nimport React from 'react';\nimport './css/CollectionsPage.css';\nimport './css/common.css';\nimport IndexedDbRepository from './IndexedRepository';\nimport { Link } from 'react-router-dom';\nimport { saveAs } from 'file-saver';\nimport Menu from './Menu';\n\nclass CollectionItemPg extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleDelete = async idToDelete => {\n      var colImg = await this.repository.searchByField('photos', 'collections', idToDelete);\n\n      if (window.confirm('Удалить данную коллекцию?')) {\n        if (window.confirm('Удалить также и изображения коллекции?')) {\n          for (const element of colImg) {\n            await this.repository.deleteById('photos', element.id);\n          }\n        } else {\n          for (const element of colImg) {\n            element.collection = null;\n            await this.repository.save('photos', element);\n          }\n        }\n\n        this.repository.deleteById('collections', idToDelete).then(() => {\n          alert('Коллекция была удалена успешно!');\n          window.location = '/';\n        });\n      }\n    };\n\n    this.state = {\n      images: []\n    };\n    this.saveCollection = this.saveCollection.bind(this);\n    this.handleDelete = this.handleDelete.bind(this);\n  }\n\n  componentDidMount() {\n    document.title = \"Страница коллекции\";\n    this.repository = new IndexedDbRepository(\"id\");\n    this.repository.searchByField('photos', 'collections', this.props.match.params.colName).then(images => this.setState({\n      images\n    }));\n  }\n\n  async saveCollection() {\n    var JSZip = require(\"jszip\");\n\n    var zip = new JSZip();\n    var img = zip.folder(\"images\");\n\n    for (const image of this.state.images) {\n      var imgData = btoa(image.image);\n      var imgName = image.name + image.mimetype;\n      img.file(imgName, imgData, {\n        base64: true\n      });\n    }\n\n    var archiveName = this.props.match.params.colName + '.zip';\n    zip.generateAsync({\n      type: \"blob\"\n    }).then(function (base64) {\n      saveAs(base64, archiveName);\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      class: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Menu, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 21\n      }\n    }, \"Коллекция \" + this.props.match.params.colName)), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"photo-wall\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"ul\", {\n      class: \"photosUl\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 21\n      }\n    }, this.state.images.map(imgcontent => {\n      return /*#__PURE__*/React.createElement(\"li\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        class: \"post\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 37\n        }\n      }, /*#__PURE__*/React.createElement(Link, {\n        to: /imgpage/ + imgcontent.id,\n        class: \"btnlink\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 41\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        class: \"photoDiv\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 45\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        class: \"photoImg\",\n        src: 'data:image/' + imgcontent.mimetype.split('.').pop() + ';base64,' + btoa(imgcontent.image),\n        alt: \"preview\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 49\n        }\n      })))));\n    })), /*#__PURE__*/React.createElement(\"button\", {\n      class: \"button\",\n      type: \"button\",\n      onClick: async () => {\n        await this.saveCollection();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 21\n      }\n    }, \"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C \\u043A\\u043E\\u043B\\u043B\\u0435\\u043A\\u0446\\u0438\\u044E\"), /*#__PURE__*/React.createElement(\"button\", {\n      class: \"button\",\n      type: \"button\",\n      onClick: async () => {\n        await this.handleDelete(this.props.match.params.colName);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 21\n      }\n    }, \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u0434\\u0430\\u043D\\u043D\\u0443\\u044E \\u043A\\u043E\\u043B\\u043B\\u0435\\u043A\\u0446\\u0438\\u044E\")));\n  }\n\n}\n\nexport default CollectionItemPg;","map":{"version":3,"sources":["C:/Users/User/Desktop/internship/new/gallery/src/CollectionItemPg.js"],"names":["React","IndexedDbRepository","Link","saveAs","Menu","CollectionItemPg","Component","constructor","props","handleDelete","idToDelete","colImg","repository","searchByField","window","confirm","element","deleteById","id","collection","save","then","alert","location","state","images","saveCollection","bind","componentDidMount","document","title","match","params","colName","setState","JSZip","require","zip","img","folder","image","imgData","btoa","imgName","name","mimetype","file","base64","archiveName","generateAsync","type","render","map","imgcontent","split","pop"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport './css/CollectionsPage.css';\r\nimport './css/common.css';\r\nimport IndexedDbRepository from './IndexedRepository';\r\nimport {Link} from 'react-router-dom';\r\nimport { saveAs } from 'file-saver';\r\nimport Menu from './Menu';\r\n\r\nclass CollectionItemPg extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            images: []\r\n        }\r\n        this.saveCollection = this.saveCollection.bind(this);\r\n        this.handleDelete = this.handleDelete.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        document.title = \"Страница коллекции\";\r\n        this.repository = new IndexedDbRepository(\"id\");\r\n        this.repository.searchByField('photos', 'collections', this.props.match.params.colName).then( images => this.setState( { images } ) );\r\n        \r\n    }\r\n\r\n    handleDelete = async( idToDelete ) => {\r\n        var colImg = await this.repository.searchByField('photos', 'collections', idToDelete);\r\n        if(window.confirm('Удалить данную коллекцию?'))\r\n        {\r\n            if(window.confirm('Удалить также и изображения коллекции?'))\r\n            {\r\n                for (const element of colImg) {\r\n                    await this.repository.deleteById( 'photos', element.id );\r\n                }\r\n            }\r\n            else\r\n            {\r\n                for (const element of colImg) {\r\n                    element.collection = null;\r\n                    await this.repository.save( 'photos', element);\r\n                }\r\n            }\r\n            this.repository.deleteById( 'collections', idToDelete )\r\n            .then(() =>{alert('Коллекция была удалена успешно!'); window.location = ('/')});\r\n        }\r\n        \r\n    }\r\n\r\n    async saveCollection() {\r\n        var JSZip = require(\"jszip\");\r\n        var zip = new JSZip();\r\n        var img = zip.folder(\"images\");\r\n        for(const image of this.state.images) {\r\n            var imgData = btoa(image.image);\r\n            var imgName = image.name + image.mimetype;\r\n            img.file( imgName, imgData, {base64: true});\r\n        }\r\n        var archiveName = this.props.match.params.colName + '.zip';\r\n        zip.generateAsync({type:\"blob\"})\r\n        .then(function(base64) {\r\n            saveAs(base64, archiveName);\r\n        });\r\n\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div class=\"container\">\r\n                <div class = \"header\"> \r\n                    <Menu />\r\n                    <h1>{\"Коллекция \" + this.props.match.params.colName}</h1>\r\n                </div>\r\n                <div id=\"photo-wall\">\r\n                    <ul class = \"photosUl\">\r\n                        {this.state.images.map((imgcontent) => {\r\n                            return (\r\n                                <li>\r\n                                    <div class=\"post\">\r\n                                        <Link to={/imgpage/+ imgcontent.id} class=\"btnlink\" >\r\n                                            <div class = \"photoDiv\">\r\n                                                <img class = \"photoImg\" src = {'data:image/' + imgcontent.mimetype.split('.').pop() + ';base64,' + btoa(imgcontent.image)} alt = \"preview\"/>\r\n                                            </div>        \r\n                                        </Link>\r\n                                    </div>\r\n                                </li>\r\n                            );\r\n                        })}     \r\n                    </ul>\r\n                    <button class = \"button\" type = \"button\" onClick = {async () => {await this.saveCollection()}}>Сохранить коллекцию</button>\r\n                    <button class = \"button\" type = \"button\" onClick = {async () => {await this.handleDelete(this.props.match.params.colName)}}>Удалить данную коллекцию</button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default CollectionItemPg;"]},"metadata":{},"sourceType":"module"}